<!doctype html>
{% load static %}
<html lang="ko">
<head>

    <link href="{% static 'blog/bootstrap/bootstrap.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'blog/css/landing.css' %}" rel="stylesheet" type="text/css">
    <script src="https://kit.fontawesome.com/f825ae5235.js" crossorigin="anonymous"></script>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="{% static 'blog/billboard/billboard.js' %}"></script>
    <link  href="{% static 'blog/billboard/billboard.css' %}" rel="stylesheet">

    <meta charset="UTF-8">
    <title>Welcome to the Aquarium</title>

</head>
<body>

{% include  'blog/navbar.html' %}

<section>
    <div class="container mt-5 ">
        <h2 class="text-light">Today's pH and temperature Graph</h2>
        <li class="row justify-content-between">

            <!--  grape   -->
            <div class="col-lg-12 rounded card">
                <div class="card-body">
                    <p class="alert alert-success" role="alert">
                        <script class="mr-auto">
                            let today = new Date();

                            let year = today.getFullYear(); // 년도
                            let month = today.getMonth() + 1;  // 월
                            let date = today.getDate();  // 날짜
                            let day = today.getDay();  // 요일

                            document.write(year + '-' + month + '-' + date )
                        </script>
                        </p>
                        <div id="axisLabelPosition"></div>
                    </div>
                </div>
        </li>
    </div>
</section>

<div class="fixed-bottom">
    {% include 'blog/footer.html' %}
</div>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
        integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
        crossorigin="anonymous"></script>

<script>
        function getArduino(){
            // 비동기방식
            var async = new XMLHttpRequest();
            async.onreadystatechange = function(event) {
                if (async.readyState == 4 && async.status == 200) {
                    console.log(async.responseText);
                    var deserializeJson = JSON.parse(async.responseText);
                    var items = JSON.parse(deserializeJson);

                    var aPH = ["pH"];
                    var aX = ["x"];
                    var aTemperature = ["T"]

                    for (item of items) {
                        aPH.push(item.fields.ph);
                        aTemperature.push(item.fields.temperature);
                        aX.push(item.fields.created_at.split('.')[0]);
                    }

                    // 데일리 차트생성
                    var chart = bb.generate({

                      data: {
                        x: "x",
                        xFormat: "%Y-%m-%dT%H:%M:%S",
                        columns: [aX, aPH, aTemperature],
                        type: "line", // for ESM specify as: line()
                        axes: {
                                aPH: "y",
                                aTemperature: "y2"
                               }
                      },

                      axis: {
                        x: {
                          type: "timeseries",
                          tick: {
                            format: "%H:%M:%S"
                                },
                          label: {
                            text: "Time",
                            position: "outer-center"
                                 }
                            },

                        y: {
                           label: {
                                text: "pH",
                                position: "outer-middle"
                                }
                            },

                        y2: {
                           show: true,
                           label: {
                                text: "Temperature[℃]",
                                position: "outer-middle"
                              }
                           }
                      },

                      bindto: "#axisLabelPosition"
                    });
                        }
                    };
            async.open('GET', '/api/arduino', true);
            async.send();

        }

        let timerID = setInterval(getArduino, 2000);

        function stopArduino(timerID) {
            clearInterval(timerID);
        }

        setTimeout(stopArduino,10000);


</script>

</body>
</html>

